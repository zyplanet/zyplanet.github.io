<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '9V8EBROCRY',
      apiKey: '6b200bc430358347660a03d2b1ec3836',
      indexName: 'blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="最优控制理论Introduction最优控制解决的是对某个给定的系统寻找其一个满足特定最优标准的控制规律。它是变分法的一个扩展，也是一种得到控制规律的数值最优方法。这一方法大部分由Lev Pontryagin和Richard Bellman发展，最优控制可以视为控制理论中的一个控制策略。一个控制问题包括一个损失泛函，它是状态变量与控制变量的函数。一个最优控制是描述最小化损失泛函控制变量路径的微分方">
<meta name="keywords" content="Dynamic System">
<meta property="og:type" content="article">
<meta property="og:title" content="optimal control theory">
<meta property="og:url" content="https://zyplanet.github.io/2019/06/11/optimal control theory/index.html">
<meta property="og:site_name" content="diphda">
<meta property="og:description" content="最优控制理论Introduction最优控制解决的是对某个给定的系统寻找其一个满足特定最优标准的控制规律。它是变分法的一个扩展，也是一种得到控制规律的数值最优方法。这一方法大部分由Lev Pontryagin和Richard Bellman发展，最优控制可以视为控制理论中的一个控制策略。一个控制问题包括一个损失泛函，它是状态变量与控制变量的函数。一个最优控制是描述最小化损失泛函控制变量路径的微分方">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://i.loli.net/2019/08/27/LSjclJVi2TqyzHC.png">
<meta property="og:image" content="https://i.loli.net/2019/08/27/Icrn2bFQKAeVJay.png">
<meta property="og:updated_time" content="2022-06-22T13:09:59.155Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="optimal control theory">
<meta name="twitter:description" content="最优控制理论Introduction最优控制解决的是对某个给定的系统寻找其一个满足特定最优标准的控制规律。它是变分法的一个扩展，也是一种得到控制规律的数值最优方法。这一方法大部分由Lev Pontryagin和Richard Bellman发展，最优控制可以视为控制理论中的一个控制策略。一个控制问题包括一个损失泛函，它是状态变量与控制变量的函数。一个最优控制是描述最小化损失泛函控制变量路径的微分方">
<meta name="twitter:image" content="https://i.loli.net/2019/08/27/LSjclJVi2TqyzHC.png">
  <link rel="canonical" href="https://zyplanet.github.io/2019/06/11/optimal control theory/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>optimal control theory | diphda</title>
  <meta name="generator" content="Hexo 3.9.0">
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">diphda</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Study hard and make progress every day.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-schedule">
      
    

    <a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>Schedule</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input" id="search-input"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="https://zyplanet.github.io/2019/06/11/optimal control theory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="diphda">
      <meta itemprop="description" content="Please feel free to discuss with us about any questions.">
      <meta itemprop="image" content="https://z3.ax1x.com/2021/09/10/hjts9s.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="diphda">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">optimal control theory

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-06-11 21:00:00" itemprop="dateCreated datePublished" datetime="2019-06-11T21:00:00+08:00">2019-06-11</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-22 21:09:59" itemprop="dateModified" datetime="2022-06-22T21:09:59+08:00">2022-06-22</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Notes/" itemprop="url" rel="index"><span itemprop="name">Notes</span></a></span>

                
                
              
            </span>
          

          
            <span id="/2019/06/11/optimal control theory/" class="post-meta-item leancloud_visitors" data-flag-title="optimal control theory" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/06/11/optimal control theory/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2019/06/11/optimal control theory/" itemprop="commentCount"></span></a>
  </span>
  
  
          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">Symbols count in article: </span>
              
              <span>21k</span>
            </span>
          
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">Reading time &asymp;</span>
              
              <span>35 mins.</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="最优控制理论">最优控制理论</h1><h2 id="introduction">Introduction</h2><p>最优控制解决的是对某个给定的系统寻找其一个满足特定最优标准的控制规律。它是变分法的一个扩展，也是一种得到控制规律的数值最优方法。这一方法大部分由Lev Pontryagin和Richard Bellman发展，最优控制可以视为控制理论中的一个控制策略。一个控制问题包括一个损失泛函，它是状态变量与控制变量的函数。一个最优控制是描述最小化损失泛函控制变量路径的微分方程集合，它可以由Pontryagon极小法则（这是一个必要条件）得到，或者通过求解Hamilton-Jacobi-Bellman方程（充分条件）得到。</p><a id="more"></a>


<h3 id="控制动力系统">控制动力系统</h3>
<p>令<span class="math inline">\(A\subset\mathbb{R}^m\)</span>，<span class="math inline">\(\mathbf{f} : \mathbb{R}^{n} \times A \rightarrow \mathbb{R}^{n}\)</span>，<span class="math inline">\(\alpha :[0, \infty) \rightarrow A\)</span>，考虑如下的动力系统： <span class="math display">\[
\left\{\begin{array}{ll}{\dot{\mathbf{x}}(t)=\mathbf{f}(\mathbf{x}(t), \boldsymbol{\alpha}(t))} &amp; {(t&gt;0)} \\ {\mathbf{x}(0)=x^{0}}\end{array}\right.\tag{1.1}
\]</span> 我们称<span class="math inline">\(\boldsymbol{\alpha} :[0, \infty) \longrightarrow A\)</span>为一个控制，对应每个控制的轨迹<span class="math inline">\(\mathbf{x}(\cdot)\)</span>为对应系统的响应。</p>
<p>这里定义<span class="math inline">\(\mathcal{A}=\{\boldsymbol{\alpha} :[0, \infty) \rightarrow A | \boldsymbol{\alpha}(\cdot) \text {measurable }\}\)</span>为可行控制空间。</p>
<h3 id="损失泛函">损失泛函</h3>
<p>通常来说损失泛函的形式如下： <span class="math display">\[
P[\boldsymbol{\alpha}(\cdot)] :=\int_{0}^{T} r(\mathbf{x}(t), \boldsymbol{\alpha}(t)) d t+g(\mathbf{x}(T))\tag{1.2}
\]</span> 这里<span class="math inline">\(\mathrm{x}(\cdot)\)</span>为<span class="math inline">\(\boldsymbol{\alpha}(\cdot)\)</span>下动力系统的解，<span class="math inline">\(r : \mathbb{R}^{n} \times A \rightarrow \mathbb{R}\)</span>，<span class="math inline">\(g : \mathbb{R}^{n} \rightarrow \mathbb{R}\)</span>为给定的度量。一般称<span class="math inline">\(r\)</span>为控制代价，<span class="math inline">\(g\)</span>为终止代价，终止点<span class="math inline">\(T&gt;0\)</span>也是提前给定的。</p>
<p>基本的问题是，我们想要在<span class="math inline">\(\mathcal{A}\)</span>中找到一个能够最小化损失泛函的控制<span class="math inline">\(\alpha^{*}(\cdot)\)</span>，这引出了如下的三个问题：</p>
<ol type="1">
<li>最优控制的存在性</li>
<li>怎样刻画这个最优控制</li>
<li>最优控制如何构造</li>
</ol>
<h2 id="可控性与bang-bang-原理">可控性与Bang-Bang 原理</h2>
<p>仍然考虑式子<span class="math inline">\((1.1)\)</span>描述的控制动力系统，我们从可控性问题开始。</p>
<h3 id="可控性问题">可控性问题</h3>
<p>给定初始点<span class="math inline">\(x^{0}\)</span>以及一个目标集合<span class="math inline">\(S \subset \mathbb{R}^{n}\)</span>，是否存在一个控制能够在有限时间内将系统导引至<span class="math inline">\(S\)</span>中？首先我们并不给定一个损失泛函以刻画某个最优控制，而是关注是否存在能够将系统导引至给定目标的控制，这里通常假定<span class="math inline">\(S=\{0\}\)</span>.</p>
<p>时刻t的可达集<span class="math inline">\(\mathcal{C}(t)\)</span>为，由存在控制使得<span class="math inline">\(\mathbf{x}(t)=0\)</span>的初值点<span class="math inline">\(x^{0}\)</span>构成的集合。</p>
<p>全局可达集<span class="math inline">\(C\)</span>为，存在控制及某个有限时间<span class="math inline">\(t\)</span>使得<span class="math inline">\(\mathbf{x}(t)=0\)</span>的初值点<span class="math inline">\(x^0\)</span>构成的集合。</p>
<p>显然有如下关系成立： <span class="math display">\[
\mathcal{C}=\bigcup_{t \geq 0} \mathcal{C}(t)\tag{2.1}
\]</span></p>
<h3 id="线性系统的可控性">线性系统的可控性</h3>
<p>很自然地，我们从最简单的一类控制系统开始： <span class="math display">\[
\left\{\begin{array}{ll}{\dot{\mathbf{x}}(t)=M \mathbf{x}(t)+N \alpha(t)} &amp; {(t&gt;0)} \\ {\mathbf{x}(0)=x^{0}}\end{array}\right.\tag{2.2}
\]</span> 这里<span class="math inline">\(M \in \mathbb{M}^{n \times n}\)</span>，<span class="math inline">\(N \in \mathbb{M}^{n \times m}\)</span>，并限制控制参量的选取仅在一个单位方格中： <span class="math display">\[
A=[-1,1]^{m}=\left\{a \in \mathbb{R}^{m}| | a_{i} | \leq 1, i=1, \ldots, m\right\}\tag{2.3}
\]</span> 我们可以得到系统<span class="math inline">\((2.2)\)</span>的解析形式解： <span class="math display">\[
\mathbf{x}(t)=\mathbf{X}(t) x^{0}+\mathbf{X}(t) \int_{0}^{t} \mathbf{X}^{-1}(s) N \alpha(s) d s\tag{2.4}
\]</span> 那么我们可以得到此时<span class="math inline">\(x^{0} \in \mathcal{C}(t)\)</span>的等价条件： <span class="math display">\[
x^{0}=-\int_{0}^{t} \mathbf{X}^{-1}(s) N \alpha(s) d s\tag{2.5}
\]</span> 若存在<span class="math inline">\(\alpha(\cdot) \in \mathcal{A}\)</span>使得上式成立。</p>
<p>在线性控制系统中，可达集拥有比较好的性质：</p>
<ul>
<li>可达集<span class="math inline">\(\mathcal{C}\)</span>是对称（<span class="math inline">\(\pm x\)</span>同时含于可达集中）且凸的</li>
<li>若<span class="math inline">\(x^{0} \in \mathcal{C}(\overline{t})\)</span>，则<span class="math inline">\(x^{0} \in \mathcal{C}(t)\)</span>对任意<span class="math inline">\(t \geq \overline{t}\)</span>成立</li>
</ul>
<p>定义可控性矩阵为： <span class="math display">\[
G=G(M, N) :=\underbrace{\left[N, M N, M^{2} N, \ldots, M^{n-1} N\right]}_{n \times(m n) \text { matrix }}\tag{2.6}
\]</span> 关于线性系统的可控性，有如下的等价条件： <span class="math display">\[
\operatorname{rank} G=n\Leftrightarrow 0 \in \mathcal{C}^{\circ} \tag{2.7}
\]</span> 这里概括一下证明思路：1.若控制性矩阵的秩小于n，则零空间非空2.假设<span class="math inline">\(x^0\)</span>在t时刻可达集中，利用等价条件<span class="math inline">\((2.5)\)</span>，可证零空间的元素必然正交于$x^0<span class="math inline">\(3.即\)</span>C<span class="math inline">\(为控制性矩阵零空间的正交补空间，并且过原点，不存在内点4.相反若原点不是\)</span><span class="math inline">\(的内点，由其凸性可知在\)</span>(t)$中有一个过<span class="math inline">\(0\)</span>的支持平面，那么就可以找到其法向量，构造出一个控制性矩阵的非零解。</p>
<p>我们称线性系统可控若<span class="math inline">\(\mathcal{C}=\mathbb{R}^{n}\)</span>，有如下的定理：</p>
<p>令<span class="math inline">\(A\)</span>为<span class="math inline">\(\mathbb{R}^n\)</span>的单位立方体，假定控制性矩阵秩为<span class="math inline">\(n\)</span>，并且<span class="math inline">\(M\)</span>的所有特征值实部为负，则系统是可控的。</p>
<p>实际上可以对条件进一步减弱，只要<span class="math inline">\(M\)</span>的特征值实部非正即可，这里的证明比上面定理复杂很多。</p>
<h3 id="bang-bang原理">Bang-Bang原理</h3>
<p>这里仍然在单位立方体中选取控制，一个控制<span class="math inline">\(\alpha(\cdot) \in \mathcal{A}\)</span>称为bang-bang若对于任意时刻都有<span class="math inline">\(\left|\alpha^{i}(t)\right|=1\)</span>成立，可以理解为两状态控制。这是最为简单的一种控制，关于它有如下的定理：</p>
<p>若<span class="math inline">\(x^0\in \mathcal{C}(t)\)</span>，则对于线性控制系统<span class="math inline">\((2.2)\)</span>，存在一个bang-bang控制<span class="math inline">\(\alpha(\cdot)\)</span>在t时刻将初值引导至原点。</p>
<p>关于它的证明，需要一些泛函分析的知识，这里先省略。</p>
<h2 id="pontryagin极小条件">Pontryagin极小条件</h2>
<h3 id="变分法与哈密顿动力系统">变分法与哈密顿动力系统</h3>
<p>给定一个光滑函数<span class="math inline">\(L : \mathbb{R}^{n} \times \mathbb{R}^{n} \rightarrow \mathbb{R}, L=L(x, v)\)</span>，<span class="math inline">\(L\)</span>称为拉格朗日算子，这里<span class="math inline">\(T&gt;0, x^{0}, x^{1} \in \mathbb{R}^{n}\)</span>都是被给定的。</p>
<p>最开始的变分法考虑的是下面的优化问题： <span class="math display">\[
I[\mathbf{x}(\cdot)] :=\int_{0}^{T} L(\mathbf{x}(t), \dot{\mathbf{x}}(t)) d t\tag{3.1}
\]</span> 这里<span class="math inline">\(\mathbf{x}(\cdot)\)</span>满足<span class="math inline">\(\mathbf{x}(0)=x^{0}\)</span>与<span class="math inline">\(\mathbf{x}(T)=x^{1}\)</span>，假定<span class="math inline">\(\mathbf{x}^{*}(\cdot)\)</span>为<span class="math inline">\((3.1)\)</span>的解，下面考虑如何刻画这个最优解。</p>
<p><strong>欧拉-拉格朗日方程：</strong>若<span class="math inline">\(\mathbf{x}^{*}(\cdot)\)</span>为变分问题<span class="math inline">\((3.1)\)</span>的解，那么它满足以下的欧拉-拉格朗日微分方程： <span class="math display">\[
\frac{d}{d t}\left[\nabla_{v} L\left(\mathbf{x}^{*}(t), \dot{\mathbf{x}}^{*}(t)\right)\right]=\nabla_{x} L\left(\mathbf{x}^{*}(t), \dot{\mathbf{x}}^{*}(t)\right)\tag{3.2}
\]</span> 这给出了一个必要条件，但如果我们能求解<span class="math inline">\((3.2)\)</span>，那么最优解就在这组解中。它的证明很容易查到，这里先省略。</p>
<p>下面我们将EL方程化简为一个一阶ODE，定义广义动量为： <span class="math display">\[
\mathbf{p}(t) :=\nabla_{v} L(\mathbf{x}(t), \dot{\mathbf{x}}(t))\tag{3.3}
\]</span> 这里总假设我们能从式子<span class="math inline">\((3.3)\)</span>反解出<span class="math inline">\(v\)</span>，定义一个动力系统的哈密顿子<span class="math inline">\(H : \mathbb{R}^{n} \times \mathbb{R}^{n} \rightarrow \mathbb{R}\)</span>如下： <span class="math display">\[
H(x, p)=p \cdot \mathbf{v}(x, p)-L(x, \mathbf{v}(x, p))\tag{3.4}
\]</span> 这里<span class="math inline">\(\mathbf{v}\)</span>如上定义，有下面的定理：</p>
<p>若<span class="math inline">\(\mathbf{x}(\cdot)\)</span>为EL方程的解，那么<span class="math inline">\((\mathbf{x}(\cdot), \mathbf{p}(\cdot))\)</span>满足下面的哈密顿方程： <span class="math display">\[
\left\{\begin{array}{l}{\dot{\mathbf{x}}(t)=\nabla_{p} H(\mathbf{x}(t), \mathbf{p}(t))} \\ {\dot{\mathbf{p}}(t)=-\nabla_{x} H(\mathbf{x}(t), \mathbf{p}(t))}\end{array}\right.\tag{3.5}
\]</span> 进一步，<span class="math inline">\(t \mapsto H(\mathbf{x}(t), \mathbf{p}(t))\)</span>必然为常量映射，即满足极小性的、必然遵循某种守恒性。</p>
<h3 id="拉格朗日乘子">拉格朗日乘子</h3>
<p>如果定义域没有做任何限制，那么极值点的判别标准即梯度为零，下面考虑有限制的情况。</p>
<p>在<span class="math inline">\(R :=\{x \in \mathbb{R}^{n} | g(x) \leq 0\}\)</span>中考虑，令<span class="math inline">\(x^{*} \in R\)</span>并且有<span class="math inline">\(f(x^*)=\max _{x \in R} f(x)\)</span>，这里考虑如何刻画这个极值点。</p>
<p>若<span class="math inline">\(\mathrm{x}^*\)</span>在<span class="math inline">\(R\)</span>的内部，那么<span class="math inline">\(\nabla f\left(x^{*}\right)=0\)</span>.</p>
<p>若<span class="math inline">\(\mathrm{x}^*\)</span>在<span class="math inline">\(\partial R\)</span>上，考虑<span class="math inline">\(\nabla f\left(x^{*}\right)\)</span>的方向。显然地，如下图所示的情况是不可能的：</p>
<figure>
<img src="https://i.loli.net/2019/08/27/LSjclJVi2TqyzHC.png" alt><figcaption>impossiblecase</figcaption>
</figure>
<p>这表明<span class="math inline">\(\mathrm{x}^*\)</span>在沿<span class="math inline">\(\partial R\)</span>的方向上仍然存在非零的梯度，即并未达到极值，所以必然是下图所示的情况：</p>
<figure>
<img src="https://i.loli.net/2019/08/27/Icrn2bFQKAeVJay.png" alt><figcaption>True Case</figcaption>
</figure>
<p>即<span class="math inline">\(\nabla f\left(x^{*}\right)\)</span>必然与<span class="math inline">\(\partial R\)</span>某处的法向量共线，这个法向量可以用<span class="math inline">\(\nabla g\left(x^{*}\right)\)</span>表示，所以有下面的关系成立： <span class="math display">\[
\nabla f\left(x^{*}\right)=\lambda \nabla g\left(x^{*}\right)\tag{3.6}
\]</span> 由于<span class="math inline">\(\nabla g\left(x^{*}\right)\)</span>有可能为零，所以更加准确的描述如下：</p>
<p>存在不同时为零的实数<span class="math inline">\(\lambda\)</span>与<span class="math inline">\(\mu\)</span>使得： <span class="math display">\[
\mu \nabla f\left(x^{*}\right)=\lambda \nabla g\left(x^{*}\right)\tag{3.7}
\]</span></p>
<h3 id="pontyragin极小原理">Pontyragin极小原理</h3>
<p>核心的理论结果是，如果<span class="math inline">\(\alpha^{*}(\cdot)\)</span>为一个最优控制，那么就对应着一个称为costate的函数<span class="math inline">\(\mathbf{p}^{*}(\cdot)\)</span>，它满足一个特定的极小性，我们应该把costate视作一类拉格朗日乘子。</p>
<h4 id="定时自由终止点问题">定时自由终止点问题</h4>
<p>控制理论哈密顿算子如下定义： <span class="math display">\[
H(x, p, a) :=\mathbf{f}(x, a) \cdot p+r(x, a) \qquad\left(x, p \in \mathbb{R}^{n}, a \in A\right)\tag{3.8}
\]</span> 这里给出pontryagin极小原理的描述：</p>
<p>假定<span class="math inline">\(\alpha^{*}(\cdot)\)</span>是满足<span class="math inline">\((1.1)\)</span>与给定损失泛函下的最优控制，<span class="math inline">\(\mathrm{x}^{*}(\cdot)\)</span>是对应的解，那么存在一个函数<span class="math inline">\(\mathrm{p}^{*} :[0, T] \rightarrow \mathbb{R}^{n}\)</span>，使得： <span class="math display">\[
\begin{array}{c}{\dot{\mathbf{x}}^{*}(t)=\nabla_{p} H\left(\mathbf{x}^{*}(t), \mathbf{p}^{*}(t), \boldsymbol{\alpha}^{*}(t)\right)} \\ {\dot{\mathbf{p}}^{*}(t)=-\nabla_{x} H\left(\mathbf{x}^{*}(t), \mathbf{p}^{*}(t), \boldsymbol{\alpha}^{*}(t)\right)}\end{array}\tag{3.9}
\]</span> 并且此时： <span class="math display">\[
H\left(\mathbf{x}^{*}(t), \mathbf{p}^{*}(t), \boldsymbol{\alpha}^{*}(t)\right)=\max _{a \in A} H\left(\mathbf{x}^{*}(t), \mathbf{p}^{*}(t), a\right) \qquad(0 \leq t \leq T)\tag{3.10}
\]</span> 进一步有<span class="math inline">\(t \mapsto H\left(\mathbf{x}^{*}(t), \mathbf{p}^{*}(t), \boldsymbol{\alpha}^{*}(t)\right)\)</span>为常值映射，以及终止条件： <span class="math display">\[
\mathbf{p}^{*}(T)=\nabla g\left(\mathbf{x}^{*}(T)\right)\tag{3.11}
\]</span> 这里<span class="math inline">\((3.9)\)</span>的第二个式子是伴随方程，<span class="math inline">\((3.10)\)</span>是极小（极大）原理。也称<span class="math inline">\((3.11)\)</span>为截断条件，在之后会进一步讨论。</p>
<p>更加详细地，<span class="math inline">\((3.9)\)</span>的第一个式子为： <span class="math display">\[
\dot{x}^{i *}(t)=H_{p_{i}}\left(\mathbf{x}^{*}(t), \mathbf{p}^{*}(t), \boldsymbol{\alpha}^{*}(t)\right)=f^{i}\left(\mathbf{x}^{*}(t), \boldsymbol{\alpha}^{*}(t)\right)\tag{3.12}
\]</span> 这正是原始的控制系统方程。</p>
<p>伴随方程则为： <span class="math display">\[
\begin{aligned} \dot{p}^{i *}(t) &amp;=-H_{x_{i}}\left(\mathrm{x}^{*}(t), \mathbf{p}^{*}(t), \boldsymbol{\alpha}^{*}(t)\right) \\ &amp;=-\sum_{j=1}^{n} p^{j *}(t) f_{x_{i}}^{j}\left(\mathrm{x}^{*}(t), \boldsymbol{\alpha}^{*}(t)\right)-r_{x_{i}}\left(\mathrm{x}^{*}(t), \alpha^{*}(t)\right) \end{aligned}\tag{3.13}
\]</span> 在深度学习中，大多都是定时自由终点问题，另一种情况（定终点自由时间问题）这里省略。</p>
<h3 id="应用极小原理">应用极小原理</h3>
<p>对于控制问题，直接寻找一个最优控制<span class="math inline">\(\boldsymbol{\alpha}^{*}(\cdot)\)</span>以及对应的解<span class="math inline">\(\mathrm{x}^{*}(\cdot)\)</span>并不那么容易，我们可以通过求解<span class="math inline">\(\mathbf{p}^{*}(\cdot)\)</span>来简化这个问题。这里以一个实际的例子来阐述这个过程：</p>
<p>构造一个简单的经济模型，以<span class="math inline">\(x(t)\)</span>表示<span class="math inline">\(t\)</span>时刻经济产量，<span class="math inline">\(\alpha(t)\)</span>表示<span class="math inline">\(t\)</span>时刻将产量再投资的比例，经济模型以如下的形式演化： <span class="math display">\[
\left\{\begin{array}{l}{\dot{x}(t)=\alpha(t) x(t) \quad(0 \leq t \leq T)} \\ {x(0)=x^{0}}\end{array}\right.\tag{3.14}
\]</span> 我们希望极大化总消费量： <span class="math display">\[
P[\alpha(\cdot)] :=\int_{0}^{T}(1-\alpha(t)) x(t) d t\tag{3.15}
\]</span> 使用pontryagin极小原理，有： <span class="math display">\[
f(x, a)=x a, g \equiv 0, r(x, a)=(1-a) x\tag{3.16}
\]</span> 因此有： <span class="math display">\[
H(x, p, a)=f(x, a) p+r(x, a)=p x a+(1-a) x=x+a x(p-1)\tag{3.17}
\]</span> 带入<span class="math inline">\((3.9)\)</span>有： <span class="math display">\[
\begin{array}\dot{x}(t)=H_{p}=\alpha(t) x(t)\\
\dot{p}(t)=-H_{x}=-1-\alpha(t)(p(t)-1)\end{array}\tag{3.18}
\]</span> 终止条件为： <span class="math display">\[
p(T)=g_{x}(x(T))=0\tag{3.19}
\]</span> 最后，极大原理有： <span class="math display">\[
H(x(t), p(t), \alpha(t))=\max _{0 \leq a \leq 1}\{x(t)+a x(t)(p(t)-1)\}\tag{3.20}
\]</span> 下面开始求解，根据<span class="math inline">\((3.20)\)</span>有（<span class="math inline">\(x(t)&gt;0\)</span>）： <span class="math display">\[
\alpha(t)=\left\{\begin{array}{lll}{1} &amp; {\text { if }} &amp; {p(t)&gt;1} \\ {0} &amp; {\text { if }} &amp; {p(t) \leq 1}\end{array}\right.\tag{3.21}
\]</span> 下一步需要确定<span class="math inline">\(p(\cdot)\)</span>，由<span class="math inline">\((3.18)\)</span>及<span class="math inline">\((3.19)\)</span>有： <span class="math display">\[
\left\{\begin{array}{l}{\dot{p}(t)=-1-\alpha(t)[p(t)-1] \qquad(0 \leq t \leq T)} \\ {p(T)=0}\end{array}\right.\tag{3.22}
\]</span> 下面分情况讨论，若<span class="math inline">\(p(t)\le1\)</span>，则<span class="math inline">\(\alpha(t)=0\)</span>，因此<span class="math inline">\(\dot{p}(t)=-1\)</span>，那么有<span class="math inline">\(p(t)=T-t\)</span>，而这在满足假设的条件下成立，即<span class="math inline">\(T-1 \leq t \leq T\)</span>时刻。</p>
<p>令一种情况，若<span class="math inline">\(p(t)&gt;1\)</span>，则<span class="math inline">\(\alpha(t)=1\)</span>，有： <span class="math display">\[
\dot{p}(t)=-1-(p(t)-1)=-p(t)\tag{3.23}
\]</span> 又由连续性，<span class="math inline">\(p(T-1)=1\)</span>，故而<span class="math inline">\(p(t)=e^{T-1-t}\)</span>，又需满足假设，可知这在<span class="math inline">\(0 \leq t \leq T-1\)</span>上成立。</p>
<p>综上所述，最优控制为： <span class="math display">\[
\alpha^{*}(t)=\left\{\begin{array}{ll}{1} &amp; {\text { if } \quad 0 \leq t \leq t^{*}} \\ {0} &amp; {\text { if } \quad t^{*} \leq t \leq T}\end{array}\right.\tag{3.24}
\]</span> <span class="math inline">\(t^{*}=T-1\)</span>.</p>
<h2 id="动态规划">动态规划</h2>
<h3 id="bellman方程">Bellman方程</h3>
<p>考虑下面更一般的动力系统： <span class="math display">\[
\left\{\begin{array}{l}{\dot{\mathbf{x}}(s)=\mathbf{f}(\mathbf{x}(s), \boldsymbol{\alpha}(s)) \quad(t \leq s \leq T)} \\ {\mathbf{x}(t)=x}\end{array}\right.\tag{4.1}
\]</span> 以及对应的损失泛函： <span class="math display">\[
P_{x, t}[\boldsymbol{\alpha}(\cdot)]=\int_{t}^{T} r(\mathbf{x}(s), \boldsymbol{\alpha}(s)) d s+g(\mathbf{x}(T))\tag{4.2}
\]</span> 给定<span class="math inline">\(x \in \mathbb{R}^{n}, 0 \leq t \leq T\)</span>，定义价值函数<span class="math inline">\(v(x, t)\)</span>为： <span class="math display">\[
v(x, t) :=\sup _{\boldsymbol{\alpha}(\cdot) \in \mathcal{A}} P_{x, t}[\boldsymbol{\alpha}(\cdot)] \qquad\left(x \in \mathbb{R}^{n}, 0 \leq t \leq T\right)\tag{4.3}
\]</span> 价值函数给出了<span class="math inline">\(x,t\)</span>的泛函.</p>
<p>Hamilton-Jacobi-Bellman方程刻画了价值函数，假定价值函数为<span class="math inline">\((x,t)\)</span>的<span class="math inline">\(C^1\)</span>函数，则<span class="math inline">\(v\)</span>满足如下的方程： <span class="math display">\[
\begin{array}
vv_{t}(x, t)+\max _{a \in A}\left\{\mathbf{f}(x, a) \cdot \nabla_{x} v(x, t)+r(x, a)\right\}=0 \qquad\left(x \in \mathbb{R}^{n}, 0 \leq t&lt;T\right)\\
v(x, T)=g(x) \qquad\left(x \in \mathbb{R}^{n}\right)\end{array}\tag{4.4}
\]</span> 我们可以将HJB写作： <span class="math display">\[
v_{t}(x, t)+H\left(x, \nabla_{x} v\right)=0 \qquad\left(x \in \mathbb{R}^{n}, 0 \leq t&lt;T\right)\tag{4.5}
\]</span> 这里的哈密顿子定义为： <span class="math display">\[
H(x, p) :=\max _{a \in A} H(x, p, a)=\max _{a \in A}\{\mathbf{f}(x, a) \cdot p+r(x, a)\}\tag{4.6}
\]</span> 关于HJB方程的证明比较长，这里省略。</p>
<p>动态规划方法可以描述如下：</p>
<p>1.求解HJB方程，得到价值函数<span class="math inline">\(v\)</span></p>
<p>2.利用<span class="math inline">\(v\)</span>来选取控制<span class="math inline">\(\boldsymbol{\alpha}(x, t)\)</span>，这里<span class="math inline">\(\boldsymbol{\alpha}(x, t)\)</span>满足： <span class="math display">\[
v_{t}(x, t)+\mathbf{f}(x, \boldsymbol{\alpha}(x, t)) \cdot \nabla_{x} v(x, t)+r(x, \boldsymbol{\alpha}(x, t))=0\tag{4.5}
\]</span> 3.求解如下的ODE，假定<span class="math inline">\(\boldsymbol{\alpha}(\cdot, t)\)</span>拥有比较好的性质： <span class="math display">\[
\left\{\begin{array}{ll}{\dot{\mathbf{x}}^{*}(s)=} &amp; {\mathbf{f}\left(\mathbf{x}^{*}(s), \boldsymbol{\alpha}\left(\mathbf{x}^{*}(s), s\right)\right) \quad(t \leq s \leq T)} \\ {\mathbf{x}(t)=x}\end{array}\right.\tag{4.6}
\]</span> 4.定义反馈控制为： <span class="math display">\[
\alpha^{*}(s) :=\alpha\left(\mathrm{x}^{*}(s), s\right)\tag{4.7}
\]</span> 总的来说，我们以这样的方式来设计最优控制：若系统的状态为<span class="math inline">\((x,t)\)</span>，我们使用在t时刻是的HJB的极小被满足的<span class="math inline">\(a \in A\)</span>.</p>
<p>可以证明，反馈控制即为一个最优控制，证明并不复杂。</p>
<p>由<span class="math inline">\((4.7)\)</span>的定义以及式子<span class="math inline">\((4.5)\)</span>，有： <span class="math display">\[
\begin{aligned} P_{x, t}\left[\boldsymbol{\alpha}^{*}(\cdot)\right] &amp;=\int_{t}^{T}\left(-v_{t}\left(\mathbf{x}^{*}(s), s\right)-\mathbf{f}\left(\mathbf{x}^{*}(s), \boldsymbol{\alpha}^{*}(s)\right) \cdot \nabla_{x} v\left(\mathbf{x}^{*}(s), s\right)\right) d s+g\left(\mathbf{x}^{*}(T)\right) \\ &amp;=-\int_{t}^{T} v_{t}\left(\mathbf{x}^{*}(s), s\right)+\nabla_{x} v\left(\mathbf{x}^{*}(s), s\right) \cdot \dot{\mathbf{x}}^{*}(s) d s+g\left(\mathbf{x}^{*}(T)\right) \\ &amp;=-\int_{t}^{T} \frac{d}{d s} v\left(\mathbf{x}^{*}(s), s\right) d s+g\left(\mathbf{x}^{*}(T)\right) \\ &amp;=-v\left(\mathbf{x}^{*}(T), T\right)+v\left(\mathbf{x}^{*}(t), t\right)+g\left(\mathbf{x}^{*}(T)\right) \\ &amp;=-g\left(\mathbf{x}^{*}(T)\right)+v\left(\mathbf{x}^{*}(t), t\right)+g\left(\mathbf{x}^{*}(T)\right) \\ &amp;=v(x, t)=\sup _{\boldsymbol{\alpha}(\cdot) \in \mathcal{A}} P_{x, t}[\boldsymbol{\alpha}(\cdot)] \end{aligned}
\]</span> 故而<span class="math inline">\(\boldsymbol{\alpha}^{*}(\cdot)\)</span>是最优的.</p>
<p>我们以一个简单的例子来进一步阐述这个流程，</p>
<p>运输车以以下的方程运动， <span class="math display">\[
\left(\begin{array}{c}{\dot{x}_{1}} \\ {\dot{x}_{2}}\end{array}\right)=\left(\begin{array}{ll}{0} &amp; {1} \\ {0} &amp; {0}\end{array}\right)\left(\begin{array}{c}{x_{1}} \\ {x_{2}}\end{array}\right)+\left(\begin{array}{c}{0} \\ {1}\end{array}\right) \alpha, \quad|\alpha| \leq 1
\]</span> 损失泛函为， <span class="math display">\[
P[\alpha(\cdot)]=-\text { time to reach }(0,0)=-\int_{0}^{\tau} 1 d t=-\tau
\]</span> 要使用动态规划，我们定义<span class="math inline">\(v(x_1,x_2)\)</span>为负最小到达原点时间，起始点被定为<span class="math inline">\((x_1,x_2)\)</span>.</p>
<p>优于<span class="math inline">\(v\)</span>并不依赖于<span class="math inline">\(t\)</span>，所以有： <span class="math display">\[
\max _{a \in A}\left\{\mathbf{f} \cdot \nabla_{x} v+r\right\}=0
\]</span> 并且， <span class="math display">\[
A=[-1,1], \quad \mathrm{f}=\left(\begin{array}{c}{x_{2}} \\ {a}\end{array}\right), \quad r=-1
\]</span> 那么有， <span class="math display">\[
\max _{|a| \leq 1}\left\{x_{2} v_{x_{1}}+a v_{x_{2}}-1\right\}=0
\]</span> 可得方程为： <span class="math display">\[
\left\{\begin{array}{ll}{x_{2} v_{x_{1}}+\left|v_{x_{2}}\right|-1=0} &amp; {\text { in } \mathbb{R}^{2}} \\ {v(0,0)=0}\end{array}\right.
\]</span> 下面检查方程是否满足，定义两个区域： <span class="math display">\[
I :=\left\{\left(x_{1}, x_{2}\right)|x_{1} \geq-\frac{1}{2} x_{2}| x_{2} |\right\} \quad \text { and } \quad I I :=\left\{\left(x_{1}, x_{2}\right)|x_{1} \leq-\frac{1}{2} x_{2}| x_{2} |\right\}
\]</span> 直接计算得： <span class="math display">\[
v(x)=\left\{\begin{array}{ll}{-x_{2}-2\left(x_{1}+\frac{1}{2} x_{2}^{2}\right)^{\frac{1}{2}}} &amp; {\text { in Region I }} \\ {x_{2}-2\left(-x_{1}+\frac{1}{2} x_{2}^{2}\right)^{\frac{1}{2}}} &amp; {\text { in Region II. }}\end{array}\right.
\]</span> 在区域<span class="math inline">\(I\)</span>计算可得： <span class="math display">\[
\begin{array}{l}{v_{x_{2}}=-1-\left(x_{1}+\frac{x_{2}^{2}}{2}\right)^{-\frac{1}{2}} x_{2}} \\ {v_{x_{1}}=-\left(x_{1}+\frac{x_{2}^{2}}{2}\right)^{-\frac{1}{2}}}\end{array}
\]</span> 因此： <span class="math display">\[
x_{2} v_{x_{1}}+\left|v_{x_{2}}\right|-1=-x_{2}\left(x_{1}+\frac{x_{2}^{2}}{2}\right)^{-\frac{1}{2}}+\left[1+x_{2}\left(x_{1}+\frac{x_{2}^{2}}{2}\right)^{-\frac{1}{2}}\right]-1=0
\]</span> 这表明了HJB在区域<span class="math inline">\(I\)</span>是满足的，同样也可在区域<span class="math inline">\(II\)</span>上得到验证。</p>
<p>由于<span class="math inline">\(\max _{|a| \leq 1}\left\{x_{2} v_{x_{1}}+a v_{x_{2}}+1\right\}=0\)</span>，所以可知最优控制为： <span class="math display">\[
\alpha=\operatorname{sgn} v_{x_{2}}
\]</span></p>
<h3 id="动态规划与pontryagin极小原理">动态规划与Pontryagin极小原理</h3>
<h4 id="特征方法">特征方法</h4>
<p>假定<span class="math inline">\(H : \mathbb{R}^{n} \times \mathbb{R}^{n} \rightarrow \mathbb{R}\)</span>并考虑如下的Hamilton-Jacobi方程初值问题 <span class="math display">\[
\left\{\begin{array}{l}{u_{t}(x, t)+H\left(x, \nabla_{x} u(x, t)\right)=0 \qquad\left(x \in \mathbb{R}^{n}, 0&lt;t&lt;T\right)} \\ {u(x, 0)=g(x)}\end{array}\right.\tag{4.8}
\]</span> 做以下的记号： <span class="math display">\[
\mathbf{x}(t)=\left(\begin{array}{c}{x^{1}(t)} \\ {\vdots} \\ {x^{n}(t)}\end{array}\right), \mathbf{p}(t)=\nabla_{x} u(\mathbf{x}(t), t)=\left(\begin{array}{c}{p^{1}(t)} \\ {\vdots} \\ {p^{n}(t)}\end{array}\right)\tag{4.9}
\]</span> 下面引出特征方程，有： <span class="math display">\[
p^{k}(t)=u_{x_{k}}(\mathbf{x}(t), t)\tag{4.10}
\]</span> 因此 <span class="math display">\[
\dot{p}^{k}(t)=u_{x_{k} t}(\mathbf{x}(t), t)+\sum_{i=1}^{n} u_{x_{k} x_{i}}(\mathbf{x}(t), t) \cdot \dot{x}^{i}\tag{4.11}
\]</span> 假定<span class="math inline">\(u\)</span>为式子<span class="math inline">\((4.8)\)</span>的解，我们两边对<span class="math inline">\(x_k\)</span>求导： <span class="math display">\[
u_{t x_{k}}(x, t)=-H_{x_{k}}(x, \nabla u(x, t))-\sum_{i=1}^{n} H_{p_{i}}(x, \nabla u(x, t)) \cdot u_{x_{k} x_{i}}(x, t)\tag{4.12}
\]</span> 代入式子<span class="math inline">\((4.11)\)</span>中： <span class="math display">\[
\dot{p}^{k}(t)=-H_{x_{k}}(\mathbf{x}(t), \underbrace{\nabla_{x} u(\mathbf{x}(t), t)}_{\mathbf{p}(t)})+\sum_{i=1}^{n}(\dot{x}^{i}(t)-H_{p_{i}}(\mathbf{x}(t), \underbrace{\nabla_{x} u(x, t)}_{\mathbf{p}(t)}) u_{x_{k} x_{i}}(\mathbf{x}(t), t).\tag{4.13}
\]</span> 如果我们选取<span class="math inline">\(\mathbf{x}(\cdot)\)</span>使得： <span class="math display">\[
\dot{x}^{i}(t)=H_{p_{i}}(\mathrm{x}(t), \mathbf{p}(t)), \qquad(1 \leq i \leq n)\tag{4.14}
\]</span> 那么<span class="math inline">\((4.13)\)</span>成为： <span class="math display">\[
\dot{p}^{k}(t)=-H_{x_{k}}(\mathbf{x}(t), \mathbf{p}(t)), \qquad(1 \leq k \leq n)\tag{4.15}
\]</span> 这正是哈密顿方程： <span class="math display">\[
\left\{\begin{array}{l}{\dot{\mathbf{x}}(t)=\nabla_{p} H(\mathbf{x}(t), \mathbf{p}(t))} \\ {\dot{\mathbf{p}}(t)=-\nabla_{x} H(\mathbf{x}(t), \mathbf{p}(t))}\end{array}\right.\tag{4.16}
\]</span> 接下来想要说明的是，如果我们能求解<span class="math inline">\((4.16)\)</span>，那么<span class="math inline">\((4.8)\)</span>也被相应求解。 <span class="math display">\[
\begin{aligned} \frac{d}{d t} u(\mathbf{x}(t), t) &amp;=u_{t}(\mathbf{x}(t), t)+\nabla_{x} u(\mathbf{x}(t), t) \cdot \dot{\mathbf{x}}(t) \\ &amp;=-H(\underbrace{\nabla_{x} u(\mathbf{x}(t), t)}_{\mathbf{p}(t)}, \mathbf{x}(t))+\underbrace{\nabla_{x} u(\mathbf{x}(t), t)}_{\mathbf{p}(t)} \cdot \nabla_{p} H(\mathbf{x}(t), \mathbf{p}(t)) \\ &amp;=-H(\mathbf{x}(t), \mathbf{p}(t))+\mathbf{p}(t) \cdot \nabla_{p} H(\mathbf{x}(t), \mathbf{p}(t)) \end{aligned}
\]</span> 并且有<span class="math inline">\(u(\mathbf{x}(0), 0)=u\left(x^{0}, 0\right)=g\left(x^{0}\right)\)</span>，积分可得： <span class="math display">\[
u(\mathbf{x}(t), t)=\int_{0}^{t}-H+\nabla_{p} H \cdot \mathbf{p} d s+g\left(x^{0}\right)\tag{4.17}
\]</span> 这即是<span class="math inline">\((4.8)\)</span>的解，只要<span class="math inline">\(\mathbf{x}(\cdot)\)</span>与<span class="math inline">\(\mathbf{p}(\cdot)\)</span>被求解出来。</p>
<h4 id="动态规划与pontryagin极小原理的联系">动态规划与Pontryagin极小原理的联系</h4>
<p>回忆式子<span class="math inline">\((4.1)\)</span>描述的更一般的动力系统，以及所定义的价值函数。这里主要的结果是，Pontryagin极小原理中的costate函数，实际上是价值函数<span class="math inline">\(v\)</span>对<span class="math inline">\(x\)</span>的梯度：</p>
<p>假定<span class="math inline">\(\alpha^{*}(\cdot), x^{*}(\cdot)\)</span>为方程与损失泛函的最优控制和最优解，如果价值函数<span class="math inline">\(v\)</span>为<span class="math inline">\(C^2\)</span>的则极小原理中的costate<span class="math inline">\(\mathbf{p}^{*}(\cdot)\)</span>满足以下的方程： <span class="math display">\[
\mathbf{p}^{*}(s)=\nabla_{x} v\left(\mathbf{x}^{*}(s), s\right) \qquad(t \leq s \leq T)\tag{4.18}
\]</span> 其证明较长，这里省略。</p>
<h2 id="微分博弈">微分博弈</h2>
<h3 id="定义">定义</h3>
<p>在深度学习中，博弈存在于GAN为代表的这类生成模型中，这在控制理论中也有对应的理论。这一节中讨论双人零和博弈（这正是GAN使用的）。基本的想法是，两个玩家分别控制两个动力系统，其中一个需要达到某种极大，另一个达到某种极小，并也存在着一个损失泛函。</p>
<p>对于两者最好的策略是什么？显然双方的行为不可能独立，任何一方的控制都会取决于另一方当前的状态。</p>
<p>我们对这个双控制的动力系统作出如下的定义：</p>
<p>给定<span class="math inline">\(0 \leq t&lt;T\)</span>，以及两个集合<span class="math inline">\(A \subseteq \mathbb{R}^{m}\)</span>，<span class="math inline">\(B \subseteq \mathbb{R}^{l}\)</span>与函数<span class="math inline">\(\mathrm{f} : \mathbb{R}^{n} \times A \times B \rightarrow \mathbb{R}^{n}\)</span>. 定义玩家一的控制为<span class="math inline">\(\boldsymbol{\alpha}(\cdot) :[t, T] \rightarrow A\)</span>，玩家二的控制为<span class="math inline">\(\boldsymbol{\beta}(\cdot) :[t, T] \rightarrow B\)</span>，最终的动力系统形式如下： <span class="math display">\[
\left\{\begin{array}{l}{\dot{\mathbf{x}}(s)=\mathbf{f}(\mathbf{x}(s), \boldsymbol{\alpha}(s), \boldsymbol{\beta}(s)) \qquad(t \leq s \leq T)} \\ {\mathbf{x}(t)=x}\end{array}\right.\tag{5.1}
\]</span> 初始点<span class="math inline">\(x \in \mathbb{R}^{n}\)</span>是被给定的。</p>
<p>博弈的损失泛函如下定义： <span class="math display">\[
P_{x, t}[\boldsymbol{\alpha}(\cdot), \boldsymbol{\beta}(\cdot)] :=\int_{t}^{T} r(\mathbf{x}(s), \boldsymbol{\alpha}(s), \boldsymbol{\beta}(s)) d s+g(\mathbf{x}(T))\tag{5.2}
\]</span> 在博弈中，玩家一需要选取<span class="math inline">\(\alpha(\cdot)\)</span>极大化<span class="math inline">\((5.2)\)</span>，玩家二则选取<span class="math inline">\(\boldsymbol{\beta}(\cdot)\)</span>极小化<span class="math inline">\((5.2)\)</span>. 这就是我们所说的二人零和微分博弈，这里使用动态规划来研究这个问题。</p>
<p>映射<span class="math inline">\(\Phi : B(t) \rightarrow A(t)\)</span>称为玩家一的策略若在任何<span class="math inline">\(t \leq s \leq T\)</span>中， <span class="math display">\[
\boldsymbol{\beta}(\tau) \equiv \hat{\boldsymbol{\beta}}(\tau) \quad \text { for } t \leq \tau \leq s\Rightarrow\Phi[\boldsymbol{\beta}](\tau) \equiv \Phi[\hat{\boldsymbol{\beta}}](\tau) \quad \text { for } t \leq \tau \leq s\tag{5.3}
\]</span> 我们可以认为<span class="math inline">\(\Phi[\boldsymbol{\beta}]\)</span>是玩家一对玩家二所制定策略的响应，并且条件<span class="math inline">\((5.3)\)</span>表明了玩家一并不能得到未来状态的信息。</p>
<p>玩家二的策略为映射<span class="math inline">\(\Psi : A(t) \rightarrow B(t)\)</span>，若对于任何<span class="math inline">\(t \leq s \leq T\)</span>， <span class="math display">\[
\boldsymbol{\alpha}(\tau) \equiv \hat{\boldsymbol{\alpha}}(\tau) \quad \text { for } t \leq \tau \leq s\Rightarrow \Psi[\boldsymbol{\alpha}](\tau) \equiv \Psi[\hat{\boldsymbol{\alpha}}](\tau) \quad \text { for } t \leq \tau \leq s\tag{5.4}
\]</span> 并定义策略集合： <span class="math display">\[
\begin{array}{l}{\mathcal{A}(t) :=\text { strategies for player } I \text { (starting at } t )} \\ {\mathcal{B}(t) :=\text { strategies for player } I I \text { (starting at } t )}\end{array}
\]</span> 接下来引入如下的价值函数，</p>
<p>下价值函数为： <span class="math display">\[
v(x, t) :=\inf _{\Psi \in \mathcal{B}(t)} \sup _{\boldsymbol{\alpha}(\cdot) \in A(t)} P_{x, t}[\boldsymbol{\alpha}(\cdot), \Psi[\boldsymbol{\alpha}](\cdot)]\tag{5.5}
\]</span> 上价值函数为： <span class="math display">\[
u(x, t) :=\sup _{\Phi \in \mathcal{A}(t)} \inf _{\boldsymbol{\beta}(\cdot) \in B(t)} P_{x, t}[\Phi[\boldsymbol{\beta}](\cdot), \boldsymbol{\beta}(\cdot)]\tag{5.6}
\]</span> 一个玩家宣布他的策略，即他对另一玩家策略的响应，然后由另一个玩家来选取控制。选取策略的玩家更有优势，即总有下面的关系成立： <span class="math display">\[
v(x, t) \leq u(x, t)\tag{5.7}
\]</span></p>
<h3 id="动态规划与isaacs方程">动态规划与Isaacs方程</h3>
<p>假定<span class="math inline">\(u,v\)</span>都是<span class="math inline">\(C^1\)</span>的，那么<span class="math inline">\(u\)</span>满足上Isaacs方程： <span class="math display">\[
\left\{\begin{array}{l}{u_{t}+\min _{b \in B} \max _{a \in A}\left\{\mathbf{f}(x, a, b) \cdot \nabla_{x} u(x, t)+r(x, a, b)\right\}=0} \\ {u(x, T)=g(x)}\end{array}\right.\tag{5.8}
\]</span> <span class="math inline">\(v\)</span>满足下Isaacs方程： <span class="math display">\[
\left\{\begin{array}{l}{v_{t}+\max _{a \in A} \min _{b \in B}\left\{\mathbf{f}(x, a, b) \cdot \nabla_{x} v(x, t)+r(x, a, b)\right\}=0} \\ {v(x, T)=g(x)}\end{array}\right.\tag{5.9}
\]</span> Isaacs方程实际上是HJB在双人零和博弈上的推广，同样我们可以对其进行如下改写： <span class="math display">\[
u_{t}+H^{+}\left(x, \nabla_{x} u\right)=0\tag{5.10}
\]</span> 这里上哈密顿子定义为： <span class="math display">\[
H^{+}(x, p) :=\min _{b \in B} \max _{a \in A}\{\mathbf{f}(x, a, b) \cdot p+r(x, a, b)\}\tag{5.11}
\]</span> 以及， <span class="math display">\[
v_{t}+H^{-}\left(x, \nabla_{x} v\right)=0\tag{5.12}
\]</span></p>
<p><span class="math display">\[
H^{-}(x, p) :=\max _{a \in A} \min _{b \in B}\{\mathbf{f}(x, a, b) \cdot p+r(x, a, b)\}\tag{5.13}
\]</span></p>
<p>当博弈到达均衡时，就是我们所要求解的最优点，即有： <span class="math display">\[
\max _{a \in A} \min _{b \in B}\{\mathbf{f}(\cdots) \cdot p+r(\cdots)\}=\min _{b \in B} \max _{a \in A}\{\mathbf{f}(\cdots) \cdot p+r(\cdots)\}\tag{5.14}
\]</span> 这时<span class="math inline">\(u\equiv v\)</span>，更加直接地，一个均衡状态可以如下描述： <span class="math display">\[
P_{x, t}\left[\boldsymbol{\alpha}(\cdot), \boldsymbol{\beta}^{*}(\cdot)\right] \leq P_{x, t}\left[\boldsymbol{\alpha}^{*}(\cdot), \boldsymbol{\beta}^{*}(\cdot)\right] \leq P_{x, t}\left[\boldsymbol{\alpha}^{*}(\cdot), \boldsymbol{\beta}(\cdot)\right]\tag{5.15}
\]</span> 即双方任何一方进行控制的变动，都不会使得自己得到更好的结果。</p>
<h3 id="prontryagin极小原理与博弈">Prontryagin极小原理与博弈</h3>
<p>假定均衡条件<span class="math inline">\((5.14)\)</span>满足，并且得到了最优的<span class="math inline">\(\alpha^{*}(\cdot), \beta^{*}(\cdot)\)</span>. 令<span class="math inline">\(\mathbf{x}^{*}(\cdot)\)</span>为对应动力系统的解，定义： <span class="math display">\[
\mathbf{p}^{*}(t) :=\nabla_{x} v\left(\mathbf{x}^{*}(t), t\right)=\nabla_{x} u\left(\mathbf{x}^{*}(t), t\right)\tag{5.16}
\]</span> 那么有以下的伴随方程： <span class="math display">\[
\dot{\mathbf{p}}^{*}(t)=-\nabla_{x} H\left(\mathbf{x}^{*}(t), \mathbf{p}^{*}(t), \boldsymbol{\alpha}^{*}(t), \boldsymbol{\beta}^{*}(t)\right)\tag{5.17}
\]</span> 其中有博弈论哈密顿算子： <span class="math display">\[
H(x, p, a, b) :=\mathbf{f}(x, a, b) \cdot p+r(x, a, b)\tag{5.18}
\]</span></p>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Dynamic-System/" rel="tag"># Dynamic System</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/06/03/adjoint state method/" rel="next" title="adjoint state method">
                  <i class="fa fa-chevron-left"></i> adjoint state method
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/06/29/red dragonfly/" rel="prev" title="red dragonfly">
                  red dragonfly <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc" data-target="post-toc-wrap">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview" data-target="site-overview-wrap">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#最优控制理论"><span class="nav-number">1.</span> <span class="nav-text">最优控制理论</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#introduction"><span class="nav-number">1.1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控制动力系统"><span class="nav-number">1.1.1.</span> <span class="nav-text">控制动力系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#损失泛函"><span class="nav-number">1.1.2.</span> <span class="nav-text">损失泛函</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可控性与bang-bang-原理"><span class="nav-number">1.2.</span> <span class="nav-text">可控性与Bang-Bang 原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#可控性问题"><span class="nav-number">1.2.1.</span> <span class="nav-text">可控性问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线性系统的可控性"><span class="nav-number">1.2.2.</span> <span class="nav-text">线性系统的可控性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bang-bang原理"><span class="nav-number">1.2.3.</span> <span class="nav-text">Bang-Bang原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pontryagin极小条件"><span class="nav-number">1.3.</span> <span class="nav-text">Pontryagin极小条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#变分法与哈密顿动力系统"><span class="nav-number">1.3.1.</span> <span class="nav-text">变分法与哈密顿动力系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拉格朗日乘子"><span class="nav-number">1.3.2.</span> <span class="nav-text">拉格朗日乘子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pontyragin极小原理"><span class="nav-number">1.3.3.</span> <span class="nav-text">Pontyragin极小原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定时自由终止点问题"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">定时自由终止点问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用极小原理"><span class="nav-number">1.3.4.</span> <span class="nav-text">应用极小原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态规划"><span class="nav-number">1.4.</span> <span class="nav-text">动态规划</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bellman方程"><span class="nav-number">1.4.1.</span> <span class="nav-text">Bellman方程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态规划与pontryagin极小原理"><span class="nav-number">1.4.2.</span> <span class="nav-text">动态规划与Pontryagin极小原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#特征方法"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">特征方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态规划与pontryagin极小原理的联系"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">动态规划与Pontryagin极小原理的联系</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#微分博弈"><span class="nav-number">1.5.</span> <span class="nav-text">微分博弈</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#定义"><span class="nav-number">1.5.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态规划与isaacs方程"><span class="nav-number">1.5.2.</span> <span class="nav-text">动态规划与Isaacs方程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prontryagin极小原理与博弈"><span class="nav-number">1.5.3.</span> <span class="nav-text">Prontryagin极小原理与博弈</span></a></li></ol></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="https://z3.ax1x.com/2021/09/10/hjts9s.jpg"
      alt="diphda">
  <p class="site-author-name" itemprop="name">diphda</p>
  <div class="site-description" itemprop="description">Please feel free to discuss with us about any questions.</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
          
        
          
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span>
        
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/zyplanet" title="GitHub &rarr; https://github.com/zyplanet" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:diphda@zju.edu.cn" title="E-Mail &rarr; mailto:diphda@zju.edu.cn" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://zjuvag.org/" title="https://zjuvag.org/" rel="noopener" target="_blank">VAG</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://Fenghz.github.io" title="https://Fenghz.github.io" rel="noopener" target="_blank">FHZ</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://www.jarvis73.com" title="https://www.jarvis73.com" rel="noopener" target="_blank">ZJW</a>
        </li>
      
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">diphda</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="Symbols count total">78k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">2:10</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.3.0</div>

        






  
  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
            
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=XuyqBYjh1vSXlsMsAetCJ09J-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'XuyqBYjh1vSXlsMsAetCJ09J-gzGzoHsz',
            'X-LC-Key': 'xOD8ROp7U0J7WzmMX7nJPqD4',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>






        
      </div>
    </footer>
  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>
<script src="/js/schemes/pisces.js?v=7.3.0"></script>
<script src="/js/next-boot.js?v=7.3.0"></script>



  








  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.js"></script><script src="/js/algolia-search.js?v=7.3.0"></script>















  

  
    
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    
  

  

  


<script>
NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail';
  guest = guest.split(',').filter(item => {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'XuyqBYjh1vSXlsMsAetCJ09J-gzGzoHsz',
    appKey: 'xOD8ROp7U0J7WzmMX7nJPqD4',
    placeholder: 'say something?',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);
</script>

</body>
</html>
